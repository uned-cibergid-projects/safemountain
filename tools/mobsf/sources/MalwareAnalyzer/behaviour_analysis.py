# -*- coding: utf_8 -*-
"""Perform behaviour analysis."""

from sources.common.common import logger, processControl, log_

import os

"""
from django.conf import settings

from mobsf.MobSF.utils import (
    append_scan_status,
)

logger = logging.getLogger(__name__)
"""


def analyze(checksum, sast, data):
    """Perform behaviour analysis."""
    try:
        #root = Path(settings.BASE_DIR) / 'MalwareAnalyzer' / 'views'
        #rules = root / 'android' / 'rules' / 'behaviour_rules.yaml'
        rules = os.path.join(processControl.env['realPath'], 'sources/MalwareAnalyzer/behaviour_rules.yaml')
        msg = 'Android Behaviour Analysis Started'
        #logger.info(msg)
        #append_scan_status(checksum, msg)
        log_("info", logger, msg)
        # behaviour_finds = sast.run_rules(data, rules.as_posix())
        behaviour_finds = sast.run_rules(data, rules)
        msg = 'Android Behaviour Analysis Completed'
        #logger.info(msg)
        #append_scan_status(checksum, msg)
        log_("info", logger, msg)
        return behaviour_finds
    except Exception as exp:
        msg = 'Failed to perform behaviour analysis'
        #logger.exception(msg)
        #append_scan_status(checksum, msg, repr(exp))
        log_("error", logger, repr(exp))
    return {}
